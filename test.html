<!doctype html>
<html>
<head>
<title>WASM Test</title>
<style>
// * { margin: 0; padding: 0; }
html, body { width: 100%; height: 100%; }
canvas { display: block; }
#the-canvas {
	border: 1px solid #000;
}
</style>

<script type="module">
	function get_string(ptr, len) {
		const mem = new Uint8Array(window.wasm.exports.memory.buffer);
		const data = mem.slice(ptr).slice(0, len);
		const str = new TextDecoder('utf-8').decode(data);
		return str;
	}

	var the_canvas = document.getElementById("the-canvas");
	var ctx = the_canvas.getContext('2d');
	const imports = {
		platform: {
			console_log: value => console.log(value),
			draw_circle: function(x, y, r, t0, t1) {
				ctx.beginPath();
				ctx.arc(x, y, r, t0, t1);
				ctx.fillStyle = "orange";
				ctx.fill();
				ctx.stroke();
			},
			draw_text: function(x, y, ptr, len) {
				ctx.font = "30px Segoe UI";
				ctx.fillStyle = "black";
				ctx.fillText(get_string(ptr, len), x, y);
			},
			log_string: function(ptr, len) {
				const str = get_string(ptr, len);
				console.log(str);
			},
		},
	};

	var module_buffer = new Uint8Array([0x0,0x61,0x73,0x6d,0x1,0x0,0x0,0x0,0x1,0x22,0x6,0x60,0x1,0x7f,0x0,0x60,0x5,0x7d,0x7d,0x7d,0x7d,0x7d,0x0,0x60,0x4,0x7d,0x7d,0x7f,0x7f,0x0,0x60,0x2,0x7f,0x7f,0x0,0x60,0x0,0x0,0x60,0x2,0x7d,0x7d,0x1,0x7d,0x2,0x5a,0x4,0x8,0x70,0x6c,0x61,0x74,0x66,0x6f,0x72,0x6d,0xb,0x63,0x6f,0x6e,0x73,0x6f,0x6c,0x65,0x5f,0x6c,0x6f,0x67,0x0,0x0,0x8,0x70,0x6c,0x61,0x74,0x66,0x6f,0x72,0x6d,0xb,0x64,0x72,0x61,0x77,0x5f,0x63,0x69,0x72,0x63,0x6c,0x65,0x0,0x1,0x8,0x70,0x6c,0x61,0x74,0x66,0x6f,0x72,0x6d,0x9,0x64,0x72,0x61,0x77,0x5f,0x74,0x65,0x78,0x74,0x0,0x2,0x8,0x70,0x6c,0x61,0x74,0x66,0x6f,0x72,0x6d,0xa,0x6c,0x6f,0x67,0x5f,0x73,0x74,0x72,0x69,0x6e,0x67,0x0,0x3,0x3,0x3,0x2,0x4,0x5,0x5,0x3,0x1,0x0,0x2,0x6,0x1c,0x4,0x7f,0x0,0x41,0x80,0x80,0x4,0xb,0x7f,0x0,0x41,0x80,0x80,0x4,0xb,0x7f,0x0,0x41,0x80,0x80,0x4,0xb,0x7f,0x0,0x41,0x80,0x8,0xb,0x7,0x32,0x5,0x4,0x6d,0x61,0x69,0x6e,0x0,0x4,0x3,0x68,0x79,0x70,0x0,0x5,0x6,0x6d,0x65,0x6d,0x6f,0x72,0x79,0x2,0x0,0xb,0x5f,0x5f,0x68,0x65,0x61,0x70,0x5f,0x62,0x61,0x73,0x65,0x3,0x0,0xa,0x5f,0x5f,0x64,0x61,0x74,0x61,0x5f,0x65,0x6e,0x64,0x3,0x3,0xa,0x4b,0x2,0x3a,0x0,0x41,0xfb,0x0,0x10,0x0,0x43,0x0,0x0,0xbe,0x42,0x43,0x0,0x0,0xbe,0x42,0x43,0x0,0x0,0x70,0x42,0x43,0x0,0x0,0x0,0x0,0x43,0xc3,0xf5,0xc8,0x40,0x10,0x1,0x41,0x80,0x8,0x41,0x15,0x10,0x3,0x43,0x0,0x0,0x34,0x42,0x43,0x0,0x0,0x3e,0x43,0x41,0x80,0x8,0x41,0x15,0x10,0x2,0xb,0xe,0x0,0x20,0x0,0x20,0x0,0x94,0x20,0x1,0x20,0x1,0x94,0x92,0x91,0xb,0xb,0x1c,0x1,0x0,0x41,0x80,0x8,0xb,0x15,0x48,0x65,0x6c,0x6c,0x6f,0x70,0x65,0x20,0x59,0x4f,0x55,0x54,0x55,0x42,0x45,0x20,0x4c,0x49,0x56,0x45,0x21]);
	const module = new WebAssembly.Module(module_buffer);
	window.wasm = new WebAssembly.Instance(module, imports);

	const linear_memory = window.wasm.memory;

	window.wasm.exports.main();

</script>
</head>
<body>
<canvas id="the-canvas" width="854px" height="480px"></canvas>
</body></html>